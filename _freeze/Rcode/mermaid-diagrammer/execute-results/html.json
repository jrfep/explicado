{
  "hash": "e43795894efcef925b8ae55bf322cd15",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"How to use DiagrammeR+Mermaid?\"\nsubtitle: \"Short answer: Don't!\"\nauthor: \"JosÃ© R. Ferrer-Paris\"\ndate: 01 Jul 2024\ncategories:\n - Mermaid.js\n - Diagrams\nexecute: \n  echo: true\n---\n\n\n## What I want to do\n\nI want to use the R package `DiagrammeR` to customise a Mermaid.js diagram.\n\n## Challenges\n\nI learned to use Mermaid.js to embed reproducible diagrams in quarto documents. Mermaid.js in under active development, syntax and features change from version to version. \n\nUsually Mermaid code can be embeded in a quarto document like this:\n\n\n```{mermaid}\n%%| echo: fenced\n%%| label: fig-mermaid\n%%| fig-cap: A mermaid graph\ngraph LR\n  A[qmd] --> B(Knitr)\n  A[qmd] --> C(Jupyter)\n  B(Knitr) --> D[md]\n  C(Jupyter) --> D[md]\n  D[md] --> E(pandoc)\n  E(pandoc) --> F(HTML)\n  E(pandoc) --> G(PDF)\n  E(pandoc) --> H(Word)\n  E(pandoc) --> I{and more}\n```\n\n\n:::{.aside}\nThis is the same diagramm code as the figure shown [here](/mark-updown.qmd).\n:::\n\nHowever, when loading the library `DiagrammeR` in a document, it will call a fixed version of mermaid. This means that it is stuck with a slightly outdated syntax, and that usually means sacrificing some features. Mixing `mermaid` code blocks and diagrams created within R code blocks in the same document will have unexpected results.\n\nI am slightly inclined _against_ using `DiagrammeR` for mermaid plots, but I am still testing options.\n\n## Sources\n\n- https://rdrr.io/cran/DiagrammeR/src/R/mermaid.R\n- https://www.reddit.com/r/github/comments/100mbuh/mermaid_diagram_not_working/\n- https://stackoverflow.com/questions/58689080/mermaid-diagrams-not-rendering-correctly-in-rmarkdown-xaringan-presentations\n\n## Steps in R\n\nLoad the libraries:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DiagrammeR)\nlibrary(widgetframe)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: htmlwidgets\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nexample1 <- DiagrammeR::mermaid(\"\ngraph LR;\nA((Orange)) --> B((Grey));\n\nclassDef orange fill:#f96;\nclassDef grey fill:#d3d3d3;\nclass A orange;\nclass B grey;\n\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nexample2 <- DiagrammeR(\"\ngraph LR\n  A[qmd] --> B(Knitr)\n  A[qmd] --> C(Jupyter)\n  B(Knitr) --> D[md]\n  C(Jupyter) --> D[md]\n  D[md] --> E(pandoc)\n  E(pandoc) --> F(HTML)\n  E(pandoc) --> G(PDF)\n  E(pandoc) --> H(Word)\n  E(pandoc) --> I{and more}\"\n     )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nexample3 <- mermaid(\"\nsequenceDiagram\n  participant ParticipantA\n  participant ParticipantB\n  participant ParticipantC\n  ParticipantA->>ParticipantB: I want something\n  ParticipantB->>ParticipantC: he want something\n  ParticipantC->>ParticipantB: here is something\n  ParticipantB->>ParticipantA: he got something for you\n  \", height = '100%', width = '100%')\n```\n:::\n\n\n\nDirect output (no `<iframe>`):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexample1\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"DiagrammeR html-widget html-fill-item\" id=\"htmlwidget-862e7ddf0dd4c083fa04\" style=\"width:100%;height:185px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-862e7ddf0dd4c083fa04\">{\"x\":{\"diagram\":\"\\ngraph LR;\\nA((Orange)) --> B((Grey));\\n\\nclassDef orange fill:#f96;\\nclassDef grey fill:#d3d3d3;\\nclass A orange;\\nclass B grey;\\n\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n\n```{.r .cell-code}\n# same as: widgetframe::frameableWidget(example1)\n```\n:::\n\n\nWith an `<iframe>` created with `widgetframe`:\n\n::: {.cell}\n\n```{.r .cell-code}\nwidgetframe::frameWidget(example1, height=200)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-b8f68ac8cf6e52173e69\" style=\"width:100%;height:200px;\" class=\"widgetframe html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-b8f68ac8cf6e52173e69\">{\"x\":{\"url\":\"mermaid-diagrammer_files/figure-html//widgets/widget_unnamed-chunk-5.html\",\"options\":{\"xdomain\":\"*\",\"allowfullscreen\":false,\"lazyload\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwidgetframe::frameWidget(example2, height=300)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-ddf37ab88e9b00956eb6\" style=\"width:100%;height:300px;\" class=\"widgetframe html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ddf37ab88e9b00956eb6\">{\"x\":{\"url\":\"mermaid-diagrammer_files/figure-html//widgets/widget_unnamed-chunk-6.html\",\"options\":{\"xdomain\":\"*\",\"allowfullscreen\":false,\"lazyload\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwidgetframe::frameWidget(example3, height=500)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-690c2ea90d76f39f9a9f\" style=\"width:100%;height:500px;\" class=\"widgetframe html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-690c2ea90d76f39f9a9f\">{\"x\":{\"url\":\"mermaid-diagrammer_files/figure-html//widgets/widget_unnamed-chunk-7.html\",\"options\":{\"xdomain\":\"*\",\"allowfullscreen\":false,\"lazyload\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::",
    "supporting": [
      "mermaid-diagrammer_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../site_libs/d3-3.3.8/d3.min.js\"></script>\n<script src=\"../site_libs/dagre-0.4.0/dagre-d3.min.js\"></script>\n<link href=\"../site_libs/mermaid-0.3.0/dist/mermaid.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/mermaid-0.3.0/dist/mermaid.slim.min.js\"></script>\n<link href=\"../site_libs/DiagrammeR-styles-0.2/styles.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/chromatography-0.1/chromatography.js\"></script>\n<script src=\"../site_libs/DiagrammeR-binding-1.0.10/DiagrammeR.js\"></script>\n<script src=\"../site_libs/pymjs-1.3.2/pym.v1.js\"></script>\n<script src=\"../site_libs/widgetframe-binding-0.3.1/widgetframe.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}